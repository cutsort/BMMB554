---
date: "2019-04-11"
tags: ["ChIP-seq", "DNA/Protein interactions"]
title: "Lecture 17: Studying DNA/Protein interactions"
---	

# An overview of ChIP seq

>This material is based on a variety of sources acknowledged throughout this document. It follows the logic of a comprehensive overview of ChIP-seq methodology compiled by [Shaun Mahony](http://mahonylab.org/) at Penn State. Shaun also has an excellent [presentation](http://lugh.bmb.psu.edu/teaching/ChIP-seq_analysis.pdf) covering this topic. 

## Many proteins interact with DNA

A variety of proteins interact with genomic DNA including histones and various transcription factors and related proteins:

<hr>
|             |
|-------------|
|![](/BMMB554/img/t15_prot.jpg)|
|<small>Transcription factors (TFs) bind to specific sites (transcription-factor binding sites; TFBS) that are either proximal or distal to a transcription start site. Sets of TFs can operate in functional cis-regulatory modules (CRMs) to achieve specific regulatory properties. Interactions between bound TFs and cofactors stabilize the transcription-initiation machinery to enable gene expression. The regulation that is conferred by sequence-specific binding TFs is highly dependent on the three-dimensional structure of chromatin (From [Wasserman, Sandelin:2004](http://www.nature.com/nrg/journal/v5/n4/full/nrg1315.html)).</small>|
<hr>

## The footprints of these interactions can be captured and sequenced

There interactions can captured via the process of Chromatin Immunoprecipitation (ChIP) initially developed by [Gilmore and Lis](http://www.pnas.org/content/81/14/4275.short) in 1984. ChIP-seq makes this procedure genome-wide by combining it with sequencing:

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_chip.jpg)|
|<small>Processing of ChIP fragments for Illumuna sequencing (From [Illumina](https://www.illumina.com/techniques/sequencing/dna-sequencing/chip-seq.html))</small>|
<hr>

## Resulting reads produce piles

After ChIP tags are sequenced, they are mapped to the genome using tools such as [bwa](http://bio-bwa.sourceforge.net/bwa.shtml) or [bowtie](http://bowtie-bio.sourceforge.net/bowtie2/index.shtml). Aligned reads are enriched in the genomic regions corresponding to binding sites of proteins used during the IP step. Figure below (**A**) shows that such piles of enriched reads (from which peaks are defined) are more defined in the case of ChIP-seq (as compared to ChIP-chip where tags are not sequenced but hybridized to [tiling microarrays](https://en.wikipedia.org/wiki/Tiling_array)). You can also see enrichment of tags in ChIP-seq experiment compared to input DNA (input DNA is a type of control used in ChIP-seq experiments that is simply a portion of of the sample sequenced without performing IP step). **B** panel below highlights differences between punctate and diffuse types of ChIP-seq signal. Punctate signal is characteristic of individual transcription factors (such as CTCF transcriptional repressor) or (to a lesser extent) transcriptional complexes such as RNA polymerase II. Broad diffuse signals are common for chromatine (e.g., histones) ChIP-seq experiments.

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_peak_comp.jpg)|
|<small>**A**. Examples of the profiles generated by chromatin immunoprecipitation followed by sequencing (ChIP–seq) or by microarray (ChIP–chip). Shown is a section of the binding profiles of the chromodomain protein Chromator, as measured by ChIP–chip (unlogged intensity ratio; blue) and ChIP–seq (tag density; red) in the Drosophila melanogaster S2 cell line. The tag density profile obtained by ChIP–seq reveals specific positions of Chromator binding with higher spatial resolution and sensitivity. The ChIP–seq input DNA (control experiment) tag density is shown in grey for comparison. **B**. Examples of different types of ChIP–seq tag density profiles in human T cells. Profiles for different types of proteins and histone marks can have different types of features, such as: sharp binding sites, as shown for the insulator binding protein CTCF (CCCTC-binding factor; red); a mixture of shapes, as shown for RNA polymerase II (orange), which has a sharp peak followed by a broad region of enrichment; medium size broad peaks, as shown for histone H3 trimethylated at lysine 36 (H3K36me3; green), which is associated with transcription elongation over the gene; or large domains, as shown for histone H3 trimethylated at lysine 27 (H3K27me3; blue), which is a repressive mark that is indicative of Polycomb-mediated silencing. BPIL2, bactericidal/permeability-increasing protein-like 2; FBXO7, F box only 7; NPC1, Niemann-Pick disease, type C1; Pros35, proteasome 35 kDa subunit; SYN3, synapsin III. Data for part **B** are from [Barksi:2007](http://www.sciencedirect.com/science/article/pii/S0092867407006009)]. (Image and legend from [Park:2009](http://www.nature.com/nrg/journal/v10/n10/full/nrg2641.html))</small>|
<hr>

## There are multiple types of protein-DNA binding assays.

Figure below describes seven types of protein-DNA binding assays. We will briefly describe them here:

 - **ChIP-seq** - we already touched on the main ideas of this protocol. It allows identify approximate location of binding sites ([Barski:2007](http://www.sciencedirect.com/science/article/pii/S0092867407006009)).
 - **ChIP-exo** - here experiment initially proceeds in the same way as standard ChIP-seq. However, before crosslinking is reversed DNA fragments bound to proteins are treated with [lambda exonuclease](https://www.neb.com/products/m0262-lambda-exonuclease) in 5' - 3' direction. This allows to "sharpen" the signal by polishing protein-bound DNA fragments up to the area covered by the protein. As a result much sharper peaks are produced and position of binding sites can be determined with base-pair resolution ([Rhee & Pugh:2012](http://onlinelibrary.wiley.com/doi/10.1002/0471142727.mb2124s100/abstract)).
 - **GRO-seq** - newly synthesized transcripts are labelled with  ribonucleotide analog [5-bromouridine 5′-triphosphate (BrUTP)] to BrU-tag nascent RNAs. BrU-containing RNAs are then selected through immunopurification with an antibody that is specific for this nucleotide analog, resulting in a 10,000- fold enrichment and sequenced ([Core:2008](http://science.sciencemag.org/content/322/5909/1845)).
 - **PRO-seq** - here newly synthesized transcripts are labeled with biotin-labeled NTPs. Incorporation of biotinylated NTPs also prevents RNA polymerase from continuing elongation. Pulling down biotinylated RNAs, reverse trainscribing, and sequencing results in data showing position and transcriptional direction of RNA polymerase and also allows to pinpoint precise location of transcription start sites (TSS) ([Kwak:2013](http://science.sciencemag.org/content/339/6122/950)).
 - **MNase-seq** - is a high resolution assay for identification of nucleosome positions. Here unoccupied DNA is digested by [MNase](https://www.neb.com/products/m0247-micrococcal-nuclease) - a non-specific endonuclease - leaving only occupied fragments. Paired-end sequencing of the fragments pinpoints nucleosome positions ([Albert:2007](http://www.nature.com/nature/journal/v446/n7135/abs/nature05632.html)).
 - **DNase-seq** - is an assay designed to identify nucleosome depleted regions (open chromatin). It uses [DNase I](https://www.neb.com/products/m0303-dnase-i-rnase-free) to cleave open DNA. ([Crawford:2006](http://www.nature.com/nmeth/journal/v3/n7/abs/nmeth888.html)).
 - **ATAC-seq** - is similar to DNase-seq but uses Tn5 transposase to introduce sequencing primers directly to open DNA regions ([Adey:2010](https://genomebiology.biomedcentral.com/articles/10.1186/gb-2010-11-12-r119)).

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_types_of_chip_seq.jpg)|
|<small>High-resolution protein–DNA binding assays. (From [Mahony and Pugh:2015](http://www.tandfonline.com/doi/full/10.3109/10409238.2015.1051505)).</small>|
|![](/BMMB554/img/gro-pro.png)|
|<small>GRO- and PRO-seq assays (From [Wang 2014](https://www.ncbi.nlm.nih.gov/pubmed/24561252)</small>|

<hr>

## The data is exceedingly noisy. 

One thing to keep in mind is that the efficiency of the IP step is ~35% at best and commonly is around 1 - 2% (see Figure below). In this figure the majority of experiments have fraction of reads in peaks (FRiP) score within the 0 to 5% interval. So "successful" experiment should have FRiP > 1% according to [ENCODE guidelines](http://genome.cshlp.org/content/22/9/1813.full). Look again at the figure above (not below). In pane **A** there is a comparison between ChIP-seq coverage (red peaks) and input DNA (gray peaks). You can see that gray peaks are widespread. In fact, in a typical experiment we get almost as many reads in control (input DNA) experiment as we do in ChIP experiment. So this methodology merely *enriches* reads derived from binding regions.

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_frip.png)|
|<small>Number of called peaks vs. ChIP enrichment. Except in special cases, successful experiments identify thousands to tens of thousands of peaks for most TFs and, depending on the peak finder used, numbers in the hundreds or low thousands indicate a failure (Image and legend from [Landt:2012](http://genome.cshlp.org/content/22/9/1813.full)).</small>
<hr>

# Analyzing ChIP-seq data

## Looking at data

Before diving into analysis strategies let's get a feel of how the underlying data look like. 

### Individual peaks

If we align ChIP-seq reads against genome and record coordinates of their 5'-ends:

```
position  -> 0123456789012345678901234567890123456789
                       1         2         3
genome    -> atggacgatatgacagataagagcagataggggatagata
read1     ->           tgacag
read2     ->           tgacag
read3     ->              cagata

5'-end       ----------------------------------------
histogram ->           #  #
                       #
```

we will get a type of a histogram. In the example above bar (composed of `#` symbols) at position 11 has height 2, because two reads start at this position. Bar at position 13 has height 1 because only a single read begins there. In the case of read data this will look like this (image from [Shaun Mahony](http://mahonylab.org/)):

![](/BMMB554/img/t15_hist.png)

where - and + are two DNA strands. 

Now to smooth this let's extend peaks by the length of underlying DNA fragments. The fragments are longer than reads and we know their approximate length from out experimental design. For example, if during experimental phase of ChIP-seq protocol we size selected DNA fragment at, say, 200 bp, we will extend reads by that amount. For illustration, let's say that out fragment size is 10 bp (unrealistic but helpful for drawing an example below):

```
position  -> 0123456789012345678901234567890123456789
                       1         2         3
genome    -> atggacgatatgacagataagagcagataggggatagata
read1     ->           tgacagATAA
read2     ->           tgacagATAA
read3     ->              cagataAGAG

5'-end       ----------------------------------------
histogram ->           #############
                       ##########
                          #######
``` 
now we extended the reads by expected DNA fragment length (upper case to get to 10 bp) and drew a coverage histogram. In this histogram bar height reflects the number of fragments covering this location. For read data this will look like this (image from [Shaun Mahony](http://mahonylab.org/)):

![](/BMMB554/img/t15_cov_hist.png).

The center of the binding size is somewhere between these peaks (we will discuss identification of precise binding location later).

### All peaks in an experiment

If we ignore strandedness (just combine peaks from plus and minus strands) we can aggregate all peaks from the genome by aligning their midpoints and drawing a heatmap:

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_heatmap.png)|
|<small>Aligning midpoints of peaks across the entire genome allows assessing signal across the entire experiment (image from [Shaun Mahony](http://mahonylab.org/)).</small>
<hr>

This may be especially informative when comparing results of multiple ChIP experiments:

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_multi_heat.png)|
<small>Comparison across multiple experiments shows that accessible and inaccessible regions of chromatin have similar binding to Lhx3 and Isl1 factors (image from [Shaun Mahony](http://mahonylab.org/)).</small>

## Calling peaks

There are several ways for identifying binding events. They are summarized in the figure below:

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_peak_calling.jpg)|
|<small>Outline of three ChIP-seq binding event detection methods. Peak-finding methods typically either shift the ChIP-seq tag locations in a 3′ direction by half the expected fragment length, or extend the length of the tag in a 3′ direction to be equal to the expected fragment length. Tags from opposite strands are merged to construct an unstranded tag density landscapes, and binding event locations are predicted from the locations with maximum tag coverage within each region that contains a significant enrichment of ChIP-seq tags (i.e. the peak summit). Peak-pairing methods [e.g. GeneTrack] build similar tag density landscapes, but retain strandedness information and typically do not shift or extend the tag locations. Peak locations are determined on each strand separately, and nearby peaks in the correct stranded orientation within a given distance are paired together. Binding event locations are predicted from the peak-pair midpoint locations. Probabilistic binding detection methods aim to estimate the locations of binding events that could have given rise to the observed ChIP-seq tag locations. These methods begin training with initial guesses of binding event locations and a model of how tags are expected to be distributed around real ChIP-seq binding events. During each training step, every ChIP-seq tag is probabilistically associated with nearby binding events, depending on the distance between the tag and the event location. Given these probabilistic tag assignments, binding event locations are updated to achieve a better fit with their associated tags, and the model of how tags are distributed around binding events is updated to reflect the accumulation of tags around all current binding events. During the training process, binding events with few assigned tags are weeded out of the model, and the process eventually converges to a set of final binding locations. (Figure and legend from [Mahony and Pugh:2015](http://www.tandfonline.com/doi/full/10.3109/10409238.2015.1051505)).</small>

### MACS

[MACS](https://www.ncbi.nlm.nih.gov/pubmed?cmd=search&term=18798982) (or its current version MACS2) performs several steps for calling peaks from paired treatment/control datasets:

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_macs_workflow.jpg)|
|<small>Steps of the MACS workflow (From [Feng:2012](http://www.nature.com/nprot/journal/v7/n9/full/nprot.2012.101.html).</small>
<hr>

Here is a concise description of these steps:

- **Removing redundancy** - MACS retains uniquely mapped reads and removes reads that are repeatedly mapped to the same location. This reduces effects of PCR amplification biases during library preparation.
- **Build model and estimate fragment size** - one of the MACS inputs is the fragment size or *bandwidth*, which is approximate size of DNA fragments generated during fragmentation step of library preparation. MACS first slides a window sized at twice the bandwidth across the genome and finds instances where read counts enriched by between 10 and 30 fold relative to the genome background. It then randomly samples 1,000 of such regions and build the model. To build the model it separates reads mapping to each of the strands and build two distributions (two modes). The midpoint between the two modes is the middle of the binding size and the distance between the modes is the fragment size `d` (see Figure below).

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_macs_model.png)|
<small>Peaks mapped to two strands are treated separately to build two coverage density profiles - two two modes. The distance between the modes is the fragment size `d`. This profile is build from 1,000 randomply selected enriched regions (From [Zhang:2008](https://www.ncbi.nlm.nih.gov/pubmed?cmd=search&term=18798982).</small>
<hr>

- **Generate peaks** - now that *d* has been defined MACS slides a window of size *2d* across the genome to identify regions significantly enriched in the ChIP sample. MACS assumes that background reads obey [Poisson distribution](https://en.wikipedia.org/wiki/Poisson_distribution). Thus given the number of reads in a given interval within the control sample we can calculate the probability of having observed number of reads in the ChIP sample (e.g., see flood example [here](https://en.wikipedia.org/wiki/Poisson_distribution#Examples_of_probability_for_Poisson_distributions)). This procedure is performed for several intervals around the examined location (*2d*, 1kb, 5kb, 10kb, and the whole genome) and the maximum value is chosen. One problem with this approach is that it only works if both samples (ChIP and control) are sequenced to the depth, which is not usually happening in practice. To correct with this MACS scales down the larger sample. 

- **Compute False Discovery Rate (FDR)** - [Feng:2012](http://www.nature.com/nprot/journal/v7/n9/full/nprot.2012.101.html) explains computing FDR as follows: <em>"When a control sample is available </em>(and you should really always use it - AN)<em>, MACS can also estimate an empirical FDR for every peak by exchanging the ChIP-seq and control samples and identifying peaks in the control sample using the same set of parameters used for the ChIP-seq sample. Because the control sample should not exhibit read enrichment, any such peaks found by MACS can be regarded as false positives. For a particular P value threshold, the empirical FDR is then calculated as the number of control peaks passing the threshold divided by the number of ChIP-seq peaks passing the same threshold." </em>

### GPS and multiGPS

Genome positioning system [GPS](https://www.ncbi.nlm.nih.gov/pubmed/20966006) is a sophisticated tools for discovering motifs at high resolution (e.g., in cases when multiple adjacent motifs are obscured by overlapping read piles).  Figure below explains the overall idea of the method. Instead of looking at regions enriched for reads, GPS initially assumes that every position in the genome may represent a binding event. It builds a spatial distribution of mapped reads across the genome. It also makes the assumption that in a given ChIP-seq experiment all true binding events will have approximately the same profile based on an empirical model of reads following a bimodal distribution around the binding even (pane **B** in the figure below). Different genomic locations are then made to "compete" with each other during an Expectation-Minimization procedure to take ownership of reads mapping to a given location. If the number of reads at a particular binding event drops below a threshold, this event is "forgotten". 

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_gps.jpg)|
|<small>GPS probabilistically models ChIP-Seq read spatial distributions. **A**. Protein-DNA interaction events at positions 1 and 2 on the genome result in DNA end sequence reads in the ChIP-Seq protocol. **B**. The observed spatial read density (blue: ‘+’ strand, red: ‘−’ strand) from ∼4000 CTCF events aligned with respect to the CTCF motif position at each event. **C**. GPS models ChIP-Seq reads as being generated by a mixture of binding events at every genomic base, with each event producing the characteristic spatial read density. **D**. A sparse prior on mixture components causes GPS to assign events to as few bases as possible to explain the observed reads (green and orange reads). In GPS, a given read can be explained by more than one event (yellow reads; Figure and legend from [Guo:2010](https://www.ncbi.nlm.nih.gov/pubmed/20966006)).</small>|
<hr>

As a result GPS can provide much more fine resolution for binding events as shown by performance metrics in the following figure:

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_gps_stats.jpg)|
|<small>GPS improves the effective spatial resolution and accuracy in resolving proximal binding events. **A**. Fraction of predicted CTCF binding events with a motif within the given distance with event discovery by GPS, SISSRs, MACS, cisGenome, QuEST, FindPeaks, spp-wtd and spp-mtc. Events shown were predicted by all eight methods and had a CTCF motif within 100 bp. (**B**. Fraction of binary events recovered vs. the distance between the generated synthetic events for GPS, SISSRs, MACS and QuEST. **C**. Example of a predicted binary CTCF event that contains coordinately located CTCF motifs. **D**. Number of GABP events discovered by GPS, SISSRs, MACS, cisGenome, and QuEST in regions that contain clustered GABP motifs within 500 bp (Figure and legend from [Guo:2010](https://www.ncbi.nlm.nih.gov/pubmed/20966006)).</small>

<hr>
[multiGPS](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1003501) goes further by allowing to interrogate multiple ChIP-seq experiments at once. It uses joint multi-experiment model to consider reads from a collection of experiments. As explained by [the authors](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1003501#s2) "<em>MultiGPS detects binding events independently in each experiment in each step of its iterative optimization, allowing it to model experiment-specific parameters such as the distribution of reads around binding events and the properties of background noise. The iterative optimization procedure analyzes each experimental condition in turn, using binding event locations from other experiments to form an inter-experiment prior term for a single experiment optimization. MultiGPS therefore encourages the base locations of binding events to align across experiments when appropriate, and automatically produces coherent sets of binding events that are linked across experiments without any potentially noisy windowed analysis. To our knowledge, MultiGPS is the first ChIP-seq analysis approach that uses read data from multiple experiments in a joint and fully integrated method for identifying consistent and accurate binding event locations.</em>".

<hr>
|                |
|----------------|
|![](/BMMB554/img/t15_multigps.gif)|
<small>Animation showing Expectation-Minimization iterations resulting in convergence on a set of well defined binding sites in three ChIP-seq samples (Image by [Shaun Mahony](http://mahonylab.org/software/multigps/)).</small>
<hr>



The fact that multiGPS simultaneously analyzes multiple conditions makes it uniquely suitable for the analysis of differential binding across multiple experiments as it outputs a table containing replicate specific read counts that can be directly analyzed with tools like edgeR, DeSeq, or Limma-Voom. multiGPS integrates with edgeR directly.

# What's next?

It is now time for a practical tutorial in which we will discuss various QC steps, interpretation of results, and performing differential binding analysis. This tutorial can be found [here](https://galaxyproject.org/tutorials/chip/).

